"use strict";(self.webpackChunkplonemeeting_portal_core_bundle=self.webpackChunkplonemeeting_portal_core_bundle||[]).push([[965],{4965:(e,a,l)=>{l.r(a),l.d(a,{default:()=>w});var s=l(8268),i=l(8124),c=l.n(i),r=l(7929),n=l(3368),t=l.n(n),d=l(2338),o=l(5691),m=l(3260),h=l(2484);const N={"1.3.14.3.2.26":"SHA‑1","2.16.840.1.101.3.4.2.1":"SHA‑256","2.16.840.1.101.3.4.2.2":"SHA‑384","2.16.840.1.101.3.4.2.3":"SHA‑512"},b=e=>Array.prototype.map.call(new Uint8Array(e),(e=>e.toString(16).padStart(2,"0"))).join(""),v=(e,a)=>{const l=e.typesAndValues.find((e=>e.type===a));return l?l.value.valueBlock.value:""},u=e=>v(e,"2.5.4.3"),f=e=>{if(0===e)return"0 o";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["o","Ko","Mo","Go"][a]},p=e=>{let{certs:a}=e;return(0,h.Y)("div",{className:"table-responsive",children:(0,h.FD)("table",{className:"table table-sm mb-0",children:[(0,h.Y)("thead",{className:"table-light",children:(0,h.FD)("tr",{children:[(0,h.Y)("th",{className:"fw-semibold text-dark",children:"#"}),(0,h.Y)("th",{className:"fw-semibold text-dark",children:"Sujet"}),(0,h.Y)("th",{className:"fw-semibold text-dark",children:"Émetteur"}),(0,h.Y)("th",{className:"fw-semibold text-dark",children:"Numéro de série"}),(0,h.Y)("th",{className:"fw-semibold text-dark",children:"Valide depuis"}),(0,h.Y)("th",{className:"fw-semibold text-dark",children:"Valide jusqu'au"})]})}),(0,h.Y)("tbody",{children:a.map((e=>(0,h.FD)("tr",{children:[(0,h.Y)("td",{className:"font-monospace small",children:e.idx}),(0,h.Y)("td",{className:"font-monospace small",children:e.subjectCN}),(0,h.Y)("td",{className:"font-monospace small",children:e.issuerCN}),(0,h.Y)("td",{className:"text-monospace small",children:e.serial}),(0,h.Y)("td",{className:"font-monospace small",children:e.notBefore}),(0,h.Y)("td",{className:"font-monospace small",children:e.notAfter})]},e.idx)))})]})})},Y=e=>{let{files:a}=e;return(0,h.Y)("div",{className:"table-responsive",style:{fontSize:"0.9rem",maxHeight:"250px",overflowY:"auto"},children:(0,h.FD)("table",{className:"table table-sm mb-0",children:[(0,h.Y)("thead",{className:"table-light sticky-top shadow-inner",children:(0,h.FD)("tr",{children:[(0,h.Y)("th",{className:"fw-semibold text-dark",children:"Nom de fichier"}),(0,h.Y)("th",{className:"fw-semibold text-dark",children:"Taille"})]})}),(0,h.Y)("tbody",{children:null==a?void 0:a.map(((e,a)=>(0,h.FD)("tr",{children:[(0,h.Y)("td",{className:"font-monospace small",children:e.name}),(0,h.Y)("td",{className:"font-monospace small",children:f(e.size)})]},a)))})]})})},g=e=>{let{status:a,children:l}=e;const s=t()("valid"===a?"status-valid":"status-invalid"),i=t()("valid"===a?"bi-check-circle":"bi-x-circle");return(0,h.FD)("div",{id:"timestamp-status",className:"alert card text-white border-0 mb-0 ".concat(s),role:"alert",children:[(0,h.FD)("div",{className:"d-flex align-items-center",children:[(0,h.Y)("i",{className:"bi bi-patch-check-fill me-3 fs-2 ".concat(i)}),l]}),(0,h.Y)("i",{className:"icon-bg bi bi-watch fs-1"})]})},w=()=>{const[e,a]=(0,s.useState)(null),[l,i]=(0,s.useState)(null),[n,w]=(0,s.useState)(null),[y,F]=(0,s.useState)(!1),D=async e=>{try{var l,s;F(!0);const r=await c().loadAsync(e),n=r.file("META-INF/timestamp.tst");if(!n)throw new Error("Le fichier META-INF/timestamp.tst n'est pas présent.");const t=r.file(/META-INF\/ASiCManifest.*\.xml/)[0];if(!t)throw new Error("Le fichier ASiCManifest n'est pas présent.");const m=await t.async("text"),h=/DataObjectReference\s+URI="([^"]+)"/.exec(m)[1],f=r.file(h);if(!f)throw new Error("Le fichier ".concat(h," est manquant alors qu'il est référencé dans le manifeste."));const[p,Y]=await Promise.all([f.async("arraybuffer"),n.async("arraybuffer")]);let g=null;try{const e=await c().loadAsync(p),a=Object.values(e.files).filter((e=>!e.dir));g=await Promise.all(a.map((async e=>{const a=(await e.async("arraybuffer")).byteLength;return{name:e.name,size:a}})))}catch(e){}const w=URL.createObjectURL(new Blob([Y],{type:"application/timestamped-data"})),y=URL.createObjectURL(new Blob([p],{type:"application/zip"})),D=d.mH(Y);if(-1===D.offset)throw new Error("Impossible de décoder le fichier TST.");const x=new o._Fs({schema:D.result}),S=new o.dA6({schema:x.content}),A=null===(l=S.encapContentInfo)||void 0===l||null===(l=l.eContent)||void 0===l||null===(l=l.valueBlock)||void 0===l?void 0:l.valueHex;if(!A)throw new Error("Le fichier TST ne contient pas de données encapsulées.");const k=d.mH(A),L=new o.YLc({schema:k.result}),T=null===(s=S.certificates)||void 0===s?void 0:s[0];if(!T)throw new Error("Le fichier TST ne contient aucun certificat.");const j=await S.verify({signer:0,data:p,trustedCerts:[T],checkChain:!1,extendedMode:!0});if(!j||!0!==j.signatureVerified)throw new Error("La vérification de l'horodatage a échoué.");const z=(S.certificates||[]).map(((e,a)=>({idx:a+1,subjectCN:u(e.subject),issuerCN:u(e.issuer),serial:b(e.serialNumber.valueBlock.valueHex),notBefore:e.notBefore.value.toLocaleDateString(),notAfter:e.notAfter.value.toLocaleDateString()}))),C=L.messageImprint.hashAlgorithm.algorithmId,H=N[C]||C,I=b(L.messageImprint.hashedMessage.valueBlock.valueHex),B=(e=>{if(!e||4!==e.type)return{};const a=e.value;return{cn:v(a,"2.5.4.3"),o:v(a,"2.5.4.10"),ou:v(a,"2.5.4.11"),country:v(a,"2.5.4.6"),state:v(a,"2.5.4.8"),locality:v(a,"2.5.4.7")}})(L.tsa),M={cn:B.cn||v(T.subject,"2.5.4.3"),o:B.o,ou:B.ou,country:B.country,state:B.state,locality:B.locality,serial:z.at(-1).serial,validFrom:z.at(-1).notBefore,validTo:z.at(-1).notAfter},E=L.genTime.toISOString().replace(".000Z","Z");let O={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};const U=new Intl.DateTimeFormat(void 0,O).format(L.genTime);i({file:{name:e.name,size:e.size},payload:{name:h,size:p.byteLength,url:y},embeddedFiles:g,tst:{size:Y.byteLength,genTime:L.genTime,url:w,imprintAlg:H,imprintHash:I,localStr:U,utcStr:E},tsa:M,certificates:z}),console.log("certsChain:",z),a("valid")}catch(e){console.error("Verification failed:",e),w(e.message||String(e)),a("invalid")}finally{F(!1)}},x=(0,m.hb)((e=>{const l=null==e?void 0:e[0];l&&(a(null),i(null),w(null),D(l))}),[]),{getRootProps:S,getInputProps:A,isDragActive:k,acceptedFiles:L}=(0,r.VB)({accept:{"application/zip":[".asice",".sce",".asics",".scs",".zip"]},multiple:!1,onDrop:x});return(0,h.FD)("div",{className:"container",children:[(0,h.Y)("div",{className:"row justify-content-center",children:(0,h.Y)("div",{className:"col-lg-8 mb-4",children:(0,h.FD)("div",{className:"card",children:[(0,h.Y)("div",{className:"card-header py-3",children:(0,h.FD)("div",{className:"mb-0 d-flex align-items-center fs-6 fw-light",children:[(0,h.Y)("i",{className:"bi bi-file-earmark-zip me-2"}),"Fichier à vérifier"]})}),(0,h.Y)("div",{className:"card-body p-4",children:(0,h.FD)("div",{...S(),className:t()("upload-zone p-4 text-center rounded",{"bg-light":k,"border-light-subtle":k,"border-2":k}),style:{cursor:"pointer"},children:[(0,h.Y)("input",{...A()}),(0,h.Y)("div",{className:"mb-4",children:(0,h.Y)("i",{className:"bi bi-file-earmark-arrow-up text-muted",style:{fontSize:"2rem"}})}),(0,h.FD)("div",{className:"mb-4",children:[(0,h.Y)("p",{className:"form-label fw-light mb-0 fs-5",children:k?(0,h.Y)("span",{children:"Déposez votre fichier ici"}):(0,h.FD)("span",{children:["Glissez-déposez un fichier ASiC ",(0,h.Y)("small",{children:"ou"}),"  cliquez pour sélectionner"]})}),L.length>0&&(0,h.FD)("div",{className:"mt-2",children:[(0,h.Y)("span",{children:"Fichier: "}),(0,h.Y)("strong",{className:"text-success",children:L[0].name})]})]}),(0,h.FD)("div",{className:"text-muted fw-light",children:[(0,h.Y)("i",{className:"bi bi-shield-lock me-1"}),"Les fichiers sont traités localement dans votre navigateur"]})]})})]})})}),y&&(0,h.Y)("div",{className:"row justify-content-center",children:(0,h.Y)("div",{className:"col-lg-12 mb-4",children:(0,h.FD)("div",{className:"d-flex align-items-center justify-content-center text-muted",children:[(0,h.Y)("div",{className:"spinner-border spinner-border-sm me-3",role:"status",children:(0,h.Y)("span",{className:"visually-hidden",children:"Chargement..."})}),(0,h.FD)("div",{className:"text-center",children:[(0,h.Y)("strong",{children:"Traitement en cours..."}),(0,h.Y)("div",{className:"small opacity-75",children:"Vérification de l'horodatage"})]})]})})}),"invalid"===e&&(0,h.Y)(g,{status:"invalid",children:(0,h.FD)("div",{children:["La vérification du fichier a échoué.",(0,h.Y)("div",{className:"small opacity-75 mt-1",children:n})]})}),"valid"===e&&l&&(0,h.FD)(h.FK,{children:[(0,h.Y)("div",{className:"row justify-content-center",children:(0,h.Y)("div",{className:"col-12 mb-4",children:(0,h.Y)(g,{status:"valid",details:l,error:n,children:(0,h.FD)("div",{children:["Le document est valide et a été horodaté en date du ",(0,h.Y)("strong",{className:"fs-5 d-inline-block",children:null==l?void 0:l.tst.localStr}),(0,h.Y)("div",{className:"small opacity-75 mt-1",children:"L'authenticité et l'intégrité du document ont été confirmées"})]})})})}),(0,h.FD)("div",{className:"row",children:[(0,h.Y)("div",{className:"col-xl-7 mb-4",children:(0,h.FD)("div",{className:"card h-100",children:[(0,h.Y)("div",{className:"card-header bg-secondary text-white section-header py-3",children:(0,h.FD)("div",{className:"mb-0 d-flex align-items-center fs-6 fw-light",children:[(0,h.Y)("i",{className:"bi bi-building me-2"}),"Authorité d'horodatage (TSA)"]})}),(0,h.FD)("div",{className:"card-body p-4",children:[(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Nom commun (CN)"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"info-value",children:l.tsa.cn||"—"})})]}),l.tsa.o&&(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Organisation (O)"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"info-value",children:l.tsa.o})})]}),l.tsa.ou&&(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Unité d'organisation (OU)"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"info-value",children:l.tsa.ou})})]}),(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Localisation (L)"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"info-value",children:[l.tsa.locality,l.tsa.state,l.tsa.country].filter(Boolean).join(", ")})})]}),(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.FD)("span",{className:"info-label",children:["Numéro de série",(0,h.Y)("br",{}),"du certificat"]})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("div",{className:"hash-display",children:l.tsa.serial})})]}),(0,h.FD)("div",{className:"row",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Validité du certificat"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.FD)("span",{className:"info-value",children:[l.tsa.validFrom," → ",l.tsa.validTo]})})]})]})]})}),(0,h.Y)("div",{className:"col-xl-5 mb-4",children:(0,h.FD)("div",{className:"card mb-4 h-100",children:[(0,h.Y)("div",{className:"card-header  bg-secondary text-white section-header py-3",children:(0,h.FD)("div",{className:"mb-0 d-flex align-items-center fs-6 fw-light",children:[(0,h.Y)("i",{className:"bi bi-clock me-2"}),"Jeton d'horodatage"]})}),(0,h.FD)("div",{className:"card-body p-4",children:[(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Date de création"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"info-value",children:l.tst.localStr})})]}),(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.FD)("span",{className:"info-label",children:["Algorithme ",(0,h.Y)("br",{})," de hash"]})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"badge badge-subtle",children:l.tst.imprintAlg})})]}),(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Hash"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("div",{className:"hash-display",children:l.tst.imprintHash})})]}),(0,h.FD)("div",{className:"row",children:[(0,h.Y)("div",{className:"col-sm-3 border-end"}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.FD)("a",{href:l.tst.url,download:"timestamp.tst",className:"btn btn-outline-secondary btn-sm",children:[(0,h.Y)("i",{className:"bi bi-download me-1"})," Télécharger le jeton .tst"]})})]})]})]})})]}),(0,h.Y)("div",{class:"row justify-content-center",children:(0,h.Y)("div",{class:"col-12 mb-4",children:(0,h.FD)("div",{className:"card pb-2",children:[(0,h.Y)("div",{className:"card-header section-header py-3",children:(0,h.FD)("div",{className:"mb-0 d-flex align-items-center fs-6 fw-light",children:[(0,h.Y)("i",{className:"bi bi-award me-2"}),"Chaîne de certificats"]})}),(0,h.Y)("div",{className:"card-body p-0",children:(0,h.Y)(p,{certs:l.certificates})})]})})}),(0,h.FD)("div",{className:"row justify-content-center",children:[(0,h.Y)("div",{className:"col-xl-4 mb-4",children:(0,h.FD)("div",{className:"card h-100 mb-4",children:[(0,h.Y)("div",{className:"card-header section-header py-3",children:(0,h.FD)("div",{className:"mb-0 d-flex align-items-center small fw-light",children:[(0,h.Y)("i",{className:"bi bi-file-text me-2"}),"Informations du fichier ASiC"]})}),(0,h.FD)("div",{className:"card-body p-4",children:[(0,h.FD)("div",{className:"row mb-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Nom"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"info-value",children:l.file.name})})]}),(0,h.FD)("div",{className:"row",children:[(0,h.Y)("div",{className:"col-sm-3 border-end",children:(0,h.Y)("span",{className:"info-label",children:"Taille"})}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.Y)("span",{className:"info-value",children:f(l.file.size)})})]}),(0,h.FD)("div",{className:"row mt-3",children:[(0,h.Y)("div",{className:"col-sm-3 border-end"}),(0,h.Y)("div",{className:"col-sm-9",children:(0,h.FD)("a",{href:l.payload.url,download:l.payload.name,className:"btn btn-outline-secondary btn-sm",children:[(0,h.Y)("i",{className:"bi bi-download me-1"})," Télécharger le contenu .zip"]})})]})]})]})}),(0,h.Y)("div",{className:"col-xl-8 mb-4",children:l.embeddedFiles&&(0,h.FD)("div",{className:"card h-100 pb-2 mb-4",children:[(0,h.Y)("div",{className:"card-header section-header py-3",children:(0,h.FD)("div",{className:"mb-0 d-flex align-items-center small fw-light",children:[(0,h.Y)("i",{className:"bi bi-folder2-open me-2"}),"Contenu de l'archive"]})}),(0,h.Y)("div",{className:"card-body p-0",children:(0,h.Y)(Y,{files:l.embeddedFiles})})]})})]})]})]})}}}]);