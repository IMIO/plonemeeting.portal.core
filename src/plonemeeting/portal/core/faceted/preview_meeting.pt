<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="context/main_template/macros/master"
  i18n:domain="plonemeeting.portal.core">

<body>
  <metal:content-core fill-slot="content-core">
    <metal:block define-macro="content-core">
      <div i18n:domain="plonemeeting.portal.core"
           tal:define="
        portal_url context/@@plone_portal_state/portal_url;
        folderContents folderContents | python:context.getFolderContents();
        Batch python:modules['Products.CMFPlone'].Batch;
        b_start python:request.get('b_start', 0);
        batch python:isinstance(folderContents, Batch) and folderContents or Batch(folderContents, 100, int(b_start), orphan=2);
        isAnon context/@@plone_portal_state/anonymous;
        checkPermission nocall: context/portal_membership/checkPermission">

        <div metal:use-macro="context/batch_macros/macros/navigation" />

        <div class="pm-preview-meeting">

          <span tal:condition="folderContents">
            <div class=""
                 tal:define="utils_view nocall:context/@@utils_view;
                             meeting python: utils_view.get_linked_meeting(batch);
                             meeting_utils_view nocall:meeting/@@utils_view;
                             review_state python: utils_view.get_state(meeting)"
                 tal:attributes="class string:meeting-infos ${review_state}">

              <div class="meeting-title">
                <span tal:content="meeting/title" />
                <tal:else tal:condition='not: isAnon'>
                  <a tal:condition="python: checkPermission('Modify Portal Content', meeting)"
                     href=""
                     tal:attributes="href string: ${meeting/absolute_url}/edit">
                    <img src=""
                         tal:attributes="src string:${portal_url}/++plone++plonemeeting.portal.core/assets/pencil.svg">
                  </a>
                  <a href=""
                     tal:define="url string:${meeting/absolute_url}/@@reimport_meeting"
                     tal:condition="python: checkPermission('Modify Portal Content', meeting)"
                     tal:attributes="href python: utils_view.protect_url(url)">
                    <img src=""
                         tal:attributes="src string:${portal_url}/++plone++plonemeeting.portal.core/assets/sync.svg">
                  </a>
                </tal:else>
              </div>

              <div class="meeting-last-pm-modified"
                   tal:condition='not: isAnon'>
                   <span i18n:translate="Last modification in ia.Delib">Last modification in ia.Delib</span> :
                   <span tal:content="meeting_utils_view/get_plonemeeting_last_modified" />
              </div>

              <div class="meeting-custom-info"
                   tal:condition="meeting/custom_info">
                <div class="meeting-custom-info-content"
                     tal:define="hidden meeting_utils_view/hidden_info_toggle">
                  <div id="meeting-custom-info-content-toggle"
                       tal:attributes="style python: hidden and 'display: none' or ''"
                       tal:content="structure meeting/custom_info/output" />
                  <a id="show-more-link"
                     class="toggle-link"
                     href=""
                     tal:attributes="style python: hidden and ' ' or 'display: none'"
                     i18n:translate="">Show more &darr;</a>
                  <a id="show-less-link"
                     class="toggle-link"
                     href=""
                     tal:attributes="style python: hidden and 'display: none' or ''"
                     i18n:translate="">Show less &uarr;</a>
                </div>
              </div>

            </div>

            <tal:entries tal:define="preview nocall:context/@@faceted_pm_macros/preview_meeting_item">
              <tal:entry repeat="brain batch">

                <metal:macro use-macro="preview"
                             tal:define="brain nocall:brain"/>

              </tal:entry>
            </tal:entries>

          </span>

          <span tal:condition="not: batch/sequence_length"
                class="table_faceted_no_results"
                i18n:domain="plone"
                i18n:translate="description_no_results_found">No results were found.</span>
        </div>

        <div metal:use-macro="context/batch_macros/macros/navigation" />

      </div>

    </metal:block>
  </metal:content-core>
</body>
</html>
